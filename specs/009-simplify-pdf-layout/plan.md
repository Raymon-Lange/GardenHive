# Implementation Plan: Garden PDF Layout Simplification

**Branch**: `009-simplify-pdf-layout` | **Date**: 2026-02-27 | **Spec**: [spec.md](./spec.md)

## Summary

Two targeted rendering changes to `GardenPrintView.jsx`:
1. Replace category-coloured plant cell backgrounds with neutral white (`#FFFFFF`).
2. Refactor `deriveShoppingRows` to group by plant across all beds (not per bed), remove `bedName` from row data, and sum quantities â€” then remove the Bed column from the checklist table.

No backend changes. No new packages. No new files.

## Technical Context

**Language/Version**: JavaScript + React 19 (frontend only â€” no backend changes)
**Primary Dependencies**: jsPDF 4.2.0 + html2canvas 1.4.1 (already installed â€” no changes)
**Storage**: N/A â€” PDF generated in browser memory; no persistence
**Testing**: Playwright 1.50.0 â€” existing `tests/e2e/beds.spec.js` checklist assertion updated
**Target Platform**: Browser (all modern browsers)
**Performance Goals**: No change to performance characteristics
**Constraints**: Frontend-only; no new API endpoints; no new npm packages
**Scale/Scope**: Affects every PDF generated by any user â€” map page (all beds) and checklist page

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-checked after Phase 1 design.*

| Principle | Status | Notes |
|-----------|--------|-------|
| I. Layered Separation | âœ… Pass | Pure frontend rendering change. No business logic introduced. |
| II. REST-First API Design | âœ… Pass | No new API endpoints or changes to existing ones. |
| III. Permission-Gated Multi-Tenancy | âœ… Pass | No route changes. Existing `requireAccess` covers `/api/beds`. |
| IV. Schema-Validated Data Integrity | âœ… Pass | No Mongoose model changes. |
| V. Server State via React Query / UI State | âœ… Pass | Reads from existing `useBeds()` cache. No new state. |
| VI. Test-Before-Deploy | âœ… Pass | Existing E2E PDF test updated to verify no Bed column. |
| VII. Simplicity & YAGNI | âœ… Pass | Two edits in one file. No new abstractions. |
| VIII. Consistent Naming | âœ… Pass | No new constants or identifiers introduced. |

## Project Structure

### Documentation (this feature)

```text
specs/009-simplify-pdf-layout/
â”œâ”€â”€ plan.md              â† this file
â”œâ”€â”€ research.md          â† Phase 0 output
â”œâ”€â”€ data-model.md        â† Phase 1 output
â”œâ”€â”€ quickstart.md        â† Phase 1 output
â””â”€â”€ tasks.md             â† Phase 2 output (/speckit.tasks)
```

### Source Code (files changed)

```text
frontend/
â””â”€â”€ src/
    â””â”€â”€ components/
        â””â”€â”€ GardenPrintView.jsx    â† two edits: cell background + deriveShoppingRows + table header
```

**No new files. No backend changes. No new npm packages.**

## Complexity Tracking

> No constitution violations. No complexity entries required.

---

## Implementation Approach

### Change 1 â€” Plant Cell Background (map page)

Current code (line ~241 in `GardenPrintView.jsx`):
```js
const categoryColor = plant
  ? (CATEGORY_COLORS[plant.category] ?? CATEGORY_COLORS.vegetable)
  : 'transparent';
```

After change:
```js
const categoryColor = plant ? '#FFFFFF' : 'transparent';
```

Empty cells remain transparent. Planted cells use white. The `CATEGORY_COLORS` constant is left in place (not deleted) in case it is reused in a future feature.

### Change 2 â€” Shopping Row Derivation (checklist page)

Current `deriveShoppingRows` groups per-bed then per-plant within that bed, producing one `ShoppingListRow` per `(bed, plant)` pair with a `bedName` field.

After change, group across all beds by `plant._id`, summing `cellCount`:

```js
function deriveShoppingRows(beds) {
  const groups = {};
  beds.forEach((bed) => {
    bed.cells?.forEach((cell) => {
      if (!cell.plantId) return;
      const key = String(cell.plantId._id);
      if (!groups[key]) {
        groups[key] = {
          plantEmoji: cell.plantId.emoji || 'ğŸŒ¿',
          plantName:  cell.plantId.name,
          cellCount:  0,
        };
      }
      groups[key].cellCount++;
    });
  });
  return Object.values(groups)
    .filter((g) => g.cellCount > 0)
    .sort((a, b) => a.plantName.localeCompare(b.plantName));
}
```

### Change 3 â€” Checklist Table Header

Remove the `'Bed'` entry from the table header array and the first `<td>` from each row (`{row.bedName}`).

Current header:
```js
['Bed', 'Plant', 'Qty', 'â˜ Seed', 'â˜ Starts', 'â˜ Purchased']
```

After:
```js
['Plant', 'Qty', 'â˜ Seed', 'â˜ Starts', 'â˜ Purchased']
```
