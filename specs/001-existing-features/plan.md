# Implementation Plan: GardenHive — Existing Application Baseline

**Branch**: `001-existing-features` | **Date**: 2026-02-23 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `specs/001-existing-features/spec.md`

## Summary

GardenHive is a full-stack MERN web application for square-foot garden planning
and harvest tracking. The existing application delivers seven user-facing feature
areas — authentication, garden bed planning, plant library management, harvest
logging, analytics & reporting, garden sharing with tiered permissions, and
profile/account settings — built on Express 5 + MongoDB 7 + React 19.

This plan captures the as-built technical context, constitution compliance
status, data models, and API contracts for the entire existing codebase. Its
purpose is to serve as a stable, documented foundation for future feature
development via the speckit workflow.

## Technical Context

**Language/Version**: Node.js 22 (backend) / JavaScript + React 19 (frontend)
**Primary Dependencies**: Express 5, Mongoose 9, React Router 7, TanStack React
Query 5, Axios, Tailwind CSS 3, Recharts, Lucide React, jsonwebtoken, bcryptjs,
multer
**Storage**: MongoDB 7 (local or Docker); `mongodb-memory-server` for tests
**Testing**: Jest 29 + Supertest (backend API contract tests)
**Target Platform**: Modern web browsers; deployed as Docker containers on a
Linux VPS accessible via Tailscale VPN
**Project Type**: Full-stack web application (backend REST API + React SPA)
**Performance Goals**: API responses < 500 ms typical; analytics charts visible
within 2 s on a home internet connection (from spec SC-005)
**Constraints**: JWT stored in `localStorage`; images served from backend
`/uploads/` static route; `passwordHash` field MUST never appear in API
responses; backend tests MUST pass before any Docker build or deploy
**Scale/Scope**: Personal / household garden management; typical deployment
serves 1–10 users sharing 1–5 gardens

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-checked after Phase 1 design.*

| Principle | Status | Evidence |
|---|---|---|
| I. Layered Separation | ✅ PASS | `backend/` owns all business logic, validation, and auth; `frontend/` only calls `api.js` |
| II. REST-First API Design | ✅ PASS | All routes under `/api`; standard verbs; `{ error: "..." }` envelope; correct status codes |
| III. Permission-Gated Multi-Tenancy | ✅ PASS | `requireAccess(level)` wraps every garden data route; `?ownerId=` validated in middleware |
| IV. Schema-Validated Data Integrity | ✅ PASS | `timestamps: true` on all 5 models; pre-flight validation in routes; `season` derived in pre-save hook |
| V. React Query / Context State | ✅ PASS | Server data via React Query; auth + active garden via Context; form state via `useState` |
| VI. Test-Before-Deploy | ✅ PASS | CI runs `npm test` before build step; in-memory DB; factory helpers in `helpers.js` |
| VII. Simplicity & YAGNI | ✅ PASS | No service layer; route handlers call Mongoose directly; helpers extracted at 3+ uses |
| VIII. Naming & Code Style | ✅ PASS | camelCase fields/variables, PascalCase components, `handle`/`use`/`is` prefixes throughout |

**Gate result: All principles satisfied. No violations to document.**

## Project Structure

### Documentation (this feature)

```text
specs/001-existing-features/
├── plan.md              # This file
├── research.md          # Phase 0 — design decisions & rationale
├── data-model.md        # Phase 1 — all entity schemas
├── quickstart.md        # Phase 1 — local dev setup
├── contracts/           # Phase 1 — API endpoint contracts
│   ├── auth.md
│   ├── beds.md
│   ├── plants.md
│   ├── harvests.md
│   └── access.md
└── tasks.md             # Phase 2 — generated by /speckit.tasks
```

### Source Code (repository root)

```text
backend/
├── src/
│   ├── index.js             # Entry: MongoDB connect + server start
│   ├── app.js               # Express app, CORS, static, route mounts
│   ├── middleware/
│   │   └── auth.js          # requireAuth + requireAccess(level) factory
│   ├── models/
│   │   ├── User.js
│   │   ├── GardenBed.js
│   │   ├── Plant.js
│   │   ├── Harvest.js       # pre-save hook derives season
│   │   └── GardenAccess.js
│   ├── routes/
│   │   ├── auth.js          # /api/auth/*
│   │   ├── beds.js          # /api/beds/*
│   │   ├── plants.js        # /api/plants/*
│   │   ├── harvests.js      # /api/harvests/*
│   │   └── access.js        # /api/access/*
│   ├── seed/
│   │   ├── index.js         # Runs all seed scripts
│   │   ├── plants.js        # System plant library
│   │   ├── user.js          # Demo owner + helper
│   │   ├── beds.js          # Sample beds
│   │   └── harvests.js      # Sample harvest data
│   └── __tests__/
│       ├── setup.js
│       ├── teardown.js
│       ├── helpers.js       # Factories: createUser, createBed, createHarvest, etc.
│       ├── auth.test.js
│       ├── beds.test.js
│       ├── plants.test.js
│       ├── harvests.test.js
│       └── access.test.js
└── uploads/                 # multer upload destination (git-ignored)

frontend/
├── src/
│   ├── main.jsx
│   ├── App.jsx              # Router, QueryClientProvider, AuthProvider, GardenProvider
│   ├── index.css            # Tailwind + custom utility classes
│   ├── pages/
│   │   ├── Landing.jsx
│   │   ├── Login.jsx
│   │   ├── Signup.jsx
│   │   ├── Dashboard.jsx
│   │   ├── GardenBeds.jsx
│   │   ├── BedDetail.jsx
│   │   ├── GardenMap.jsx
│   │   ├── Harvests.jsx
│   │   ├── Analytics.jsx
│   │   ├── Admin.jsx
│   │   └── Profile.jsx
│   ├── components/
│   │   ├── AppLayout.jsx
│   │   ├── ProtectedRoute.jsx
│   │   └── PlantHarvestSummary.jsx
│   ├── context/
│   │   ├── AuthContext.jsx
│   │   └── GardenContext.jsx
│   └── lib/
│       └── api.js           # Axios instance, request/response interceptors
└── public/
```

**Structure Decision**: Web application (Option 2). The backend/frontend split
is established. All new features add to this structure — new models in
`backend/src/models/`, routes in `backend/src/routes/`, pages in
`frontend/src/pages/`, and reusable components in `frontend/src/components/`.

## Complexity Tracking

> No constitution violations — this table is intentionally empty.
